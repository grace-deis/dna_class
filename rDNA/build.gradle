task rDNADocument {
    inputs.dir 'rDNA'
    doLast {
        exec {
            workingDir 'rDNA'
            commandLine 'R', "-e", "roxygen2::roxygenize()"
        }
    }
}

task rDNABuild {
    dependsOn rDNADocument
    inputs.dir 'rDNA'
    def outputDir = file("$rootDir/build/")
    doFirst {
        delete fileTree(dir: outputDir, includes: ['*.tar.gz'])
    }
    doLast {
        mkdir "$rootDir/build"
        exec {
            workingDir "$rootDir/build/"
            commandLine 'R', "CMD", "build", "../rDNA/rDNA"
        }
    }
    outputs.dir outputDir
}

task rDNACheck {
    inputs.dir 'rDNA'
    doLast {
        mkdir "$rootDir/build"
        exec {
            workingDir "rDNA"
            commandLine 'R', "-e", "devtools::check(manual = TRUE, check_dir = '../../build/')"
        }
    }
    def outputDir = file("$rootDir/build/")
    outputs.dir outputDir
}

task rDNATest {
    inputs.dir 'rDNA'
    doLast {
        mkdir "$rootDir/build"
        exec {
            workingDir "rDNA"
            commandLine 'R', "-e", "devtools::test()"
        }
        exec {
            workingDir "rDNA"
            commandLine 'R', "-e", "withr::with_envvar(c('NOT_CRAN' = 'true'), covr::codecov(quiet = FALSE))"
        }
    }
}

task build {
    dependsOn rDNABuild
    inputs.dir 'rDNA'
    def outputDir = file("$rootDir/build/")
    outputs.dir outputDir
    doLast {}
}
